exports.dragToGoBack = function(options) {

    const threshold = 33;

    const Draggabilly = require('draggabilly');

    // Add the handle
    $(".drag-to-go-back").append('<div class="drag-to-go-back-handle"></div>');

    $(".drag-to-go-back").before('<div class="drag-to-go-back-indicator-container">\
                                    <div class="drag-to-go-back-bg"></div>\
                                    <div class="drag-to-go-back-indicator"></div>\
                                  </div>');

    const draggie = new Draggabilly( '.drag-to-go-back', {
      handle: '.drag-to-go-back-handle',
      axis: 'x'
    });

    draggie.on('dragMove', function(event, pointer) {

      const totalWidth = $('.drag-to-go-back').outerWidth();
      const thresholdWidth = totalWidth * (threshold / 100);
      const pixelsMoved = pointer.screenX;
      const opacity = pixelsMoved / thresholdWidth;

      $('.drag-to-go-back-indicator').css('opacity', opacity);
      $('.drag-to-go-back-indicator').css('left', opacity * 15);

    });

    draggie.on('dragEnd', function(event, pointer) {

      const totalWidth = $('.drag-to-go-back').outerWidth();
      const pixelsMoved = pointer.screenX;
      const percentageMoved = (pixelsMoved / totalWidth) * 100;
      if (percentageMoved < threshold) {
        //Reset
         $('.drag-to-go-back').animate({
          left: 0
        }, 100 );

      } else {

        //Finish the animation
         $('.drag-to-go-back').animate({
          left: '110%'
        }, 100, function() {
          //Trigger event
          if (window.plugins && window.plugins.nativepagetransitions) window.plugins.nativepagetransitions.slide({ direction: "right", fixedPixelsTop: 50, fixedPixelsBottom: 50, duration: 200 });
          tabHistory.goBack();
        });


      }
    });

};


//Remove the visual when we leave
FlowRouter.triggers.enter(function(context, redirect) {

  $('.drag-to-go-back-indicator-container').remove();

});
